-- database삭제
drop database if exists cafe_project;

-- database 생성
create database cafe_project;

-- database 선택
use cafe_project;

-- coffee1 테이블 생성
create table if not exists cafe_project.coffee(
	code varchar(10) not null,
	name varchar(20) not null,
	cost integer(8) not null,
	salesamount integer(8) not null,
	percentmargin integer(2) not null,
	primary key(code)
);

-- goods테이블 생성
create table if not exists cafe_project.goods (
	goodscode varchar(10), 
	supplycost integer(8),
	tax integer(8),
	salesprice integer(8),
	margincost integer(8),
	foreign key(goodscode) references coffee(code)
	on delete cascade 
);

-- 순위까지 나타내는 view 생성
create view showList as select (select count(*)+1 from goods where salesprice>g.salesprice) as crank, 
	c.code, c.name, c.cost, c.salesamount, c.percentmargin, g.supplycost, g.tax, g.salesprice, g.margincost
	from coffee c, goods g
	where c.code=g.goodscode
	order by crank asc;


-- create and gran user
grant select, insert, update, delete on cafe_project.* to 'user_erp_project' identified by '1234';
